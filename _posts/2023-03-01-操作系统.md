---
layout:     post
title:      计算机系统概述
subtitle:   操作系统的功能、 运行环境和提供的服务
date:       2021-01-01
author:     tahano
header-img: img/back2.jpg
catalog: true
tags:
    - 操作系统
---

# 1.操作系统的基本概念   

## 1.1操作系统的概念

​	操作系统(Operating System, OS) 是指控制和管理整个计算机系统的硬件与软件资源， 合理地组织、 调度计算机的工作与资源的分配， 进而为用户和其他软件提供方便接口与环境的程序集合。 操作系统是计算机系统中最基本的系统软件  

## 1.2操作系统的特征 :

### 并发

​	并发是指两个或多个事件在同一时间间隔内发生。

​	操作系统的并发性是指计算机系统中同时存在多个运行的程序， 因此它具有处理和调度多个程序同时执行的能力。 在操作系统中， 引入进程的目的是使程序能并发执行。

>注意同一时间间隔(并发)和同一时刻(并行)的区别。 在多道程序环境下， 一段时间内，宏观上有多道程序在同时执行， 而在每个时刻， 单处理机环境下实际仅能有一道程序执行， 因此微观上这些程序仍是分时交替执行的。 操作系统的并发性是通过分时得以实现的。
>
>注意， 并行性是指系统具有同时进行运算或操作的特性， 在同一时刻能完成两种或两种以上的工作。 并行性需要有相关硬件的支持， 如多流水线或多处理机硬件环境。
>
>并发和并行的区别。 例
>
>9:00-9:10仅吃面包， 在9:10-9:20仅写字， 在9:20-9:30仅吃面包， 在9:30-10:00仅写字， 那么在9:00-10:00吃面包和写字这两种行为就是并发执行的； 再如， 如果你在9:00-10:00右手写字， 左手同时拿着面包吃， 那么这两个动作就是并行执行的。

### 共享

​	资源共享即共享， 是指系统中的资源可供内存中多个并发执行的进程共同使用。 

​	共享可分为以下两种资源共享方式。

#### 互斥共享方式

​	系统中的某些资源， 如打印机、 磁带机， 虽然可供多个进程使用， 但为使得所打印或记录的结果不致造成混淆， 应规定在一段时间内只允许一个进程访问该资源。

​	为此， 当进程A访问某个资源时， 必须先提出请求， 若此时该资源空闲， 则系统便将之分配给进程A使用， 此后有其他进程也要访问该资源时(只要A未用完)就必须等待。 仅当进程A访问完并释放该资源后， 才允许另一个进程对该资源进行访问。 我们把这种资源共享方式称为**互斥式共享**

​	把在一段时间内只允许一个进程访问的资源称为**临界资源**。 计算机系统中的大多数物理设备及某些软件中所用的栈、 变量和表格， 都属于临界资源， 它们都要求被互斥地共享

#### 同时访问方式

​	系统中还有另一类资源， 这类资源允许在一段时间内由多个进程“同时” 访问。 这里所说的“同时” 通常是宏观上的， 而在微观上， 这些进程可能是**交替**地对该资源进行访问即**“分时共享"**的。 可供多个进程“同时” 访问的典型资源是磁盘设备， 一些用重入码编写的文件也可被"同时”共享， 即允许若干个用户同时访问该文件。

#### 两者关系

​	互斥共享要求一种资源在一段时间内(哪怕是一段很小的时间)只能满足一个请求，否则就会出现严重的问题， (你能想象打印机第一行打印A文档的内容、 第二行打印B文档的内容的效果吗？ )

​	同时访问共享通常要求一个请求分几个时间片段间隔地完成， 其效果与连续完成的效果相同。

---

​	并发和共享是操作系统两个最基本的特征， 两者之间互为存在的条件

 ①资源共享是以程序的并发为条件的， 若系统不允许程序并发执行， 则自然不存在资源共享问题；

 ②若系统不能对资源共享实施有效的管理， 则必将影响到程序的并发执行， 甚至根本无法并发执行。

### 虚拟

虚拟是指把一个物理上的实体变为若干逻辑上的对应物。

物理实体（前者）是实的， 即实际存在的； 而后者是虚的， 是用户感觉上的事物。

用于实现虚拟的技术， 称为虚拟技术。 

操作系统中利用了多种虚拟技术来实现虚拟处理器、 虚拟内存和虚拟外部设备等。

#### 虚拟处理器

指利用多道程序设计技术把一个物理上的CPU虚拟为多个逻辑上的CPU

虚拟处理器技术是通过多道程序设计技术， 采用让多道程序并发执行的方法， 来分时使用一个处理器的。

此时， 虽然只有一个处理器， 但它能同时为多个用户服务， 使每个终端用户都感觉有J个中央处理器（CPU）在专门为它服务。 

#### 虚拟存储器

我们把用户感觉到（但实际不存在） 的存储器称为虚拟存储器。

类似地，可以采用虚拟存储器技术将一台机器的物理存储器变为虚拟存储器，以便从逻辑上扩充存储器的容量。当然，这时用户所感觉到的内存容量是虚的。 

#### 虚拟设备技术

将一台物理I/O设备虚拟为多台逻辑上的I/O设备， 并允许每个用户占用一台逻辑上的I/O设备， 使原来仅允许在一段时间内由一个用户访问的设备（即临界资源）变为在一段时间内允许多个用户同时访问的共享设备。

---

操作系统的虚拟技术可归纳为

时分复用技术， 如处理器的分时共享

空分复用技术，如虚拟存储器。



### 异步

多道程序环境允许多个程序并发执行，但由于资源有限，进程的执行并不是一贯到底的，而是走走停停的，它以不可预知的速度向前推进， 这就是进程的异步性。

异步性使得操作系统运行在一种随机的环境下， 可能导致进程产生与时间有关的错误（就像对全局变量的访问顺序不当会导致程序出错一样） 。 

然而，只要运行环境相同，操作系统就须保证多次运行进程后都能获得相同的结果。



## 1.3操作系统的目标和功能

​	为了给多道程序提供良好的运行环境， 操作系统应具有以下几方面的功能： 处理机管理、 存储器管理、 设备管理和文件管理。

​	 为了方便用户使用操作系统， 还必须向用户提供接口。 “同时，操作系统可用来扩充机器， 以提供更方便的服务、 更高的资源利用率。    

​	例， 用户是雇主， 操作系统是工人（用来操作机器），计算机是机器（由处理机、存储器、设备、文件几个部件构成），工人有熟练的技能， 能够控制和协调各个部件的工作，这就是操作系统对资源的管理； 同时，工人必须接收雇主的命令，这就是"接口"；有了工人， 机器就能发挥更大的作用， 因此工人就成了“扩充机器” 

#### 1.操作系统作为计算机系统资源的管理者

##### (1）处理机管理

​	在多道程序环境下， 处理机的分配和运行都以进程（或线程） 为基本单位， 因而对处理机的管理可归结为对进程的管理。 并发是指在计算机内同时运行多个进程， 因此进程何时创建、 何时撤销、 如何管理、 如何避免冲突、 合理共享就是进程管理的最主要的任务。 进程管理的主要功能包括进程控制、 进程同步、 进程通信、 死锁处理、 处理机调度等。

##### (2) 存储器管理

存储器管理是为了给多道程序的运行提供良好的环境， 方便用户使用及提高内存的利用率，主要包括 内存分配与回收、 地址映射、 内存保护与共享 内存扩充等功能。

##### (3) 文件管理

计算机中的信息都是以文件的形式存在的， 操作系统中负责文件管理的部分称为文件系统。文件管理包括文件存储空间的管理、 目录管理及文件读写管理和保护等。

##### (4) 设备管理

设备管理的主要任务是完成用户的I/O请求， 方便用户使用各种设备， 并提高设备的利用率，主要包括缓冲管理、 设备分配、 设备处理和虚拟设备等功能。这些工作都由"工人"负责， "雇主” 无须关注。

#### 2.操作系统作为用户与计算机硬件系统之间的接口

​	为了让用户方便、 快捷、 可靠地操纵计算机硬件并运行自己的程序， 操作系统还提供了用户接口。 操作系统提供的接口主要分为两类： 一类是命令接口， 用户利用这些操作命令来组织和控制作业的执行； 另一类是程序接口， 编程人员可以使用它们来请求操作系统服务。

##### (1) 命令接口

​	使用命令接口进行作业控制的主要方式有两种， 即联机控制方式和脱机控制方式。 按作业控制方式的不同， 可将命令接口分为联机命令接口和脱机命令接口。

联机命令接口又称交互式命令接口， 适用于分时或实时系统的接口。 它由一组键盘操作命令组成。 用户通过控制台或终端输入操作命令， 向系统提出各种服务要求。 用户每输入一条命令，控制权就转给操作系统的命令解释程序， 然后由命令解释程序解释并执行输入的命令， 完成指定的功能。 之后， 控制权转回控制台或终端， 此时用户又可输入下一条命令。 联机命令接口可以这样理解： “雇主” 说一句话， "工人” 做一件事， 并做出反馈， 这就强调了交互性。

脱机命令接口又称批处理命令接口， 适用于批处理系统， 它由一组作业控制命令组成。 脱机用户不能直接干预作业的运行， 而应事先用相应的作业控制命令写成一份作业操作说明书， 连同作业一起提交给系统。 系统调度到该作业时， 由系统中的命令解释程序逐条解释执行作业说明书上的命令， 从而间接地控制作业的运行。 脱机命令接口可以这样理解： "雇主” 把要"工人” 做的事写在清单上， "工人” 按照清单命令逐条完成这些事， 这就是批处理。

##### (2) 程序接口

​	程序接口由一组系统调用(也称广义指令)组成。 用户通过在程序中使用这些系统调用来请求操作系统为其提供服务， 如使用各种外部设备、申请分配和回收内存及其他各种要求。

​	图形用户界面(GUI),即图形接口。 

​	GUI最终是通过调用程序接口实现的，用户通过鼠标和键盘在图形界面上单击或使用快捷键， 就能很方便地使用操作系统。 严格来说，图形接口不是操作系统的一部分， 但图形接口所调用的系统调用命令是操作系统的一部分。

#### 3.操作系统实现了对计算机资源的扩充

​	没有任何软件支持的计算机称为裸机， 它仅构成计算机系统的物质基础， 而实际呈现在用户面前的计算机系统是经过若干层软件改造的计算机。 

​	裸机在最里层， 其外面是操作系统。 操作系统所提供的资源管理功能和方便用户的各种服务功能， 将裸机改造成功能更强、 使用更方便的机器； 因此， 我们通常把覆盖了软件的机器称为扩充机器或虚拟机。"工人” 操作机器， 机器就有更大的作用， 于是“工人” 便成了 “扩充机器” 。

# 2.操作系统发展历程  

## 2.1手工操作阶段（此阶段无操作系统）

​	用户在计算机上算题的所有工作都要人工干预， 如程序的装入、 运行、 结果的输出等。 随着计算机硬件的发展， 人机矛盾（速度和资源利用） 越来越大， 必须寻求新的解决办法。

手工操作阶段有两个突出的缺点

①用户独占全机， 虽然不会出现因资源已被其他用户占用而等待的现象， 但资源利用率低。

②CPU等待手工操作， CPU的利用不充分。

唯一的解决办法就是用高速的机器代替相对较慢的手工操作来对作业进行控制。

## 2.2批处理阶段（操作系统开始出现）

​	为了解决人机矛盾及CPU和I/O设备之间速度不匹配的矛盾， 出现了批处理系统。 

按发展历程又分为单道批处理系统、 多道批处理系（多道程序设计技术出现以后）。

### 单道批处理系统

​	系统对作业的处理是成批进行的， 但内存中始终保持一道作业。 单道批处理系统是在解决人机矛盾及CPU和I/O设备速率不匹配的矛盾中形成的。 单道批处理系统的主要特征如下

1）自动性。 在顺利的情况下， 磁带上的一批作业能自动地逐个运行， 而无须人工干预。

2）顺序性。 磁带上的各道作业顺序地进入内存， 各道作业的完成顺序与它们进入内存的顺序在正常情况下应完全相同， 亦即先调入内存的作业先完成。

3）单道性。 内存中仅有一道程序运行， 即监督程序每次从磁带上只调入一道程序进入内存运行， 当该程序完成或发生异常情况时， 才换入其后继程序进入内存运行。

​	此时面临的问题是： 每次主机内存中仅存放一道作业， 每当它在运行期间（注意这里是“运行时” 而不是“完成后” ） 发出输入/输出请求后， 高速的CPU便处于等待低速的I/O完成的状态。

​	为了进一步提高资源的利用率和系统的吞吐量， 引入了多道程序技术。

### 多道批处理系统

​	多道程序设计技术允许多个程序同时进入内存并允许它们在CPU中交替地运行， 这些程序共享系统中的各种硬/软件资源。 当一道程序因I/O请求而暂停运行时， CPU便立即转去运行另一道程序。

​	它不采用某些机制来提高某一技术方面的瓶颈问题， 而让系统的各个组成部分都尽量去“忙” ， 因此切换任务所花费的时间很少， 可实现系统各部件之间的并行工作， 使其整体在单位时间内的效率翻倍。

​	当然， 多道批处理系统的设计和实现要比单道系统复杂很多， 因为要充分利用各种资源， 就要涉及各种资源的调度问题。多道程序设计的特点是

1）多道。 计算机内存中同时存放多道相互独立的程序。

2）宏观上并行。 同时进入系统的多道程序都处于运行过程中， 即它们先后开始各自的运行,但都未运行完毕。

3）微观上串行。 内存中的多道程序轮流占有CPU,交替执行。



多道程序设计技术的实现需要解决下列问题：

1） 如何分配处理器。

2） 多道程序的内存分配问题。

3） I/O设备如何分配。

4）如何组织和存放大量的程序和数据， 以方便用户使用并保证其安全性与一致性。



在批处理系统中采用多道程序设计技术就形成了多道批处理操作系统。 该系统把用户提交的作业成批地送入计算机内存，然后由作业调度程序自动地选择作业运行。

优点： 资源利用率高， 多道程序共享计算机资源， 从而使各种资源得到充分利用；系统吞吐量大，CPU和其他资源保持“忙碌” 状态。

缺点： 用户响应的时间较长； 不提供人机交互能力，用户既不能了解自己的程序的运行情况，又不能控制计算机。



## 2.3分时操作系统



​	所谓分时技术， 是指把处理器的运行时间分成很短的时间片， 按时间片轮流把处理器分配给各联机作业使用。 若某个作业在分配给它的时间片内不能完成其计算， 则该作业暂时停止运行，把处理器让给其他作业使用， 等待下一轮再继续运行。 

​	由于计算机速度很快， 作业运行轮转得也很快， 因此给每个用户的感觉就像是自己独占一台计算机。

​	分时操作系统是指多个用户通过终端同时共享一台主机， 这些终端连接在主机上， 用户可以同时与主机进行交互操作而互不干扰。 因此， 实现分时系统最关键的问题是如何使用户能与自己的作业进行交互， 即当用户在自己的终端上键入命令时， 系统应能及时接收并及时处理该命令，再将结果返回用户。

​	分时系统也是支持多道程序设计的系统， 但它不同于多道批处理系统。 

​	多道批处理是实现作业自动控制而无须人工干预的系统， 而分时系统是实现人机交互的系统， 这使得分时系统具有与批处理系统不同的特征。分时系统的主要特征如下：

1） 同时性。 同时性也称多路性， 指允许多个终端用户同时使用一台计算机， 即一台计算机与若干台终端相连接， 终端上的这些用户可以同时或基本同时使用计算机。

2） 交互性。 用户能够方便地与系统进行人机对话， 即用户通过终端采用人机对话的方式直接控制程序运行， 与同程序进行交互。

3） 独立性。系统中多个用户可以彼此独立地进行操作， 互不干扰， 单个用户感觉不到别人也在使用这台计算机， 好像只有自己单独使用这台计算机一样。

4） 及时性。用户请求能在很短时间内获得响应。 分时系统采用时间片轮转方式使一台计算机同时为多个终端服务， 使用户能够对系统的及时响应感到满意。

​	虽然分时操作系统较好地解决了人机交互问题， 但在一些应用场合， 需要系统能对外部的信息在规定的时间（比时间片的时间还短） 内做出处理（比如飞机订票系统或导弹制导系统） ， 因此，实时操作系统应运而生。

## 2.4实时操作系统

​	为了能在某个时间限制内完成某些紧急任务而不需要时间片排队， 诞生了实时操作系统。 这里的时间限制可以分为两种情况： 若某个动作必须绝对地在规定的时刻（或规定的时间范围） 发生， 则称为硬实时系统， 如飞行器的飞行自动控制系统， 这类系统必须提供绝对保证， 让某个特定的动作在规定的时间内完成。 若能够接受偶尔违反时间规定且不会引起任何永久性的损害， 则称为软实时系统， 如飞机订票系统、 银行管理系统。

在实时操作系统的控制下， 计算机系统接收到外部信号后及时进行处理， 并在严格的时限内处理完接收的事件。 实时操作系统的主要特点是及时性和可靠性

## 2.5.网络操作系统和分布式计算机系统

​	网络操作系统把计算机网络中的各台计算机有机地结合起来， 提供一种统一、 经济而有效的使用各台计算机的方法， 实现各台计算机之间数据的互相传送。 网络操作系统最主要的特点是网络中各种资源的共享及各台计算机之间的通信。

​	分布式计算机系统是由多台计算机组成并满足下列条件的系统： 系统中任意两台计算机通过通信方式交换信息； 系统中的每台计算机都具有同等的地位， 即没有主机也没有从机； 每台计算机上的资源为所有用户共享； 系统中的任意台计算机都可以构成一个子系统， 并且还能重构； 任何工作都可以分布在几台计算机上， 由它们并行工作、 协同完成。 用于管理分布式计算机系统的操作系统称为分布式计算机系统。 该系统的主要特点是： 分布性和并行性。 分布式操作系统与网络操作系统的本质不同是， 分布式操作系统中的若干计算机相互协同完成同一任务

## 2.6个人计算机操作系统

​	个人计算机操作系统是目前使用最广泛的操作系统， 它广泛应用于文字处理、 电子表格、 游戏中， 常见的有Windows、Linux和MacOS等

​	此外， 还有嵌入式操作系统、 服务器操作系统、 智能手机操作系统等  

# 3.操作系统运行环境



## 3.1处理器运行模式

在计算机系统中， 通常CPU

执行两种不同性质的程序： 一种是操作系统内核程序； 另一种是用户自编程序（即系统外层的应用程序， 或简称"应用程序” ）。对操作系统而言， 这两种程序的作用不同， 前者是后者的管理者， 因此"管理程序” （即内核程序） 要执行一些特权指令， 而“被管理程序”（即用户自编程序） 出于安全考虑不能执行这些指令。

1） 特权指令， 是指不允许用户直接使用的指令， 如I/O指令、 置中断指令， 存取用于内存保护的寄存器、 送程序状态字到程序状态字寄存器等的指令。

2） 非特权指令， 是指允许用户直接使用的指令， 它不能直接访问系统中的软硬件资源， 仅限于访问用户的地址空间， 这也是为了防止用户程序对系统造成破坏。

在具体实现上， 将CPU的运行模式划分为用户态（目态） 和核心态（又称管态、 内核态） 。

可以理解为CPU内部有一个小开关， 当小开关为0时， CPU处于核心态， 此时CPU可以执行特权指令， 切换到用户态的指令也是特权指令。 当小开关为1时， CPU处于用户态， 此时CPU只能执行非特权指令。 应用程序运行在用户态， 操作系统内核程序运行在核心态。 应用程序向操作系统请求服务时通过使用访管指令， 从而产生一个中断事件将操作系统转换为核心态。

在软件工程思想和结构化程序设计方法影响下诞生的现代操作系统， 几乎都是分层式的结构。 操作系统的各项功能分别被设置在不同的层次上。 一些与硬件关联较紧密的模块， 如时钟管理、 中断处理、 设备驱动等处于最低层。 其次是运行频率较高的程序， 如进程管理、 存储器管理和设备管理等。 这两部分内容构成了操作系统的内核。 这部分内容的指令操作工作在核心态。

内核是计算机上配置的底层软件， 它管理着系统的各种资源， 可以看作是连接应用程序和硬件的一座桥梁， 大多数操作系统的内核包括

4方面的内容。

1.时钟管理 

在计算机的各种部件中， 时钟是最关键的设备。 时钟的第一功能是计时， 操作系统需要通过时钟管理， 向用户提供标准的系统时间。 另外， 通过时钟中断的管理， 可以实现进程的切换。 例如， 在分时操作系统中采用时间片轮转调度， 在实时系统中按截止时间控制运行， 在批处理系统











# 7.其他

## 并行性与并发性的区别和联系

​	并行性和并发性是既相似又有区别的两个概念。 并行性是指两个或多个事件在同一时刻发生， 并发性是指两个或多个事件在同一时间间隔内发生。

​	在多道程序环境下， 并发性是指在一段时间内， 宏观上有多个程序同时运行， 但在单处理器系统中每个时刻却仅能有一道程序执行， 因此微观上这些程序只能分时地交替执行。 若在计算机系统中有多个处理器， 则这些可以并发执行的程序便被分配到多个处理器上， 实现并行执行， 即利用每个处理器来处理一个可并发执行的程序。

## 特权指令与非特权指令

​	所谓特权指令， 是指有特殊权限的指令， 由于这类指令的权限最大， 使用不当将导致整个系统崩溃， 如清内存、 置时钟、 分配系统资源、 修改虚存的段表或页表、 修改用户的访问权限等。若所有程序都能使用这些指令， 则系统一天死机次就不足为奇。 为保证系统安全， 这类指令只能用于操作系统或其他系统软件， 不直接提供给用户使用。 因此， 特权指令必须在核心态执行。实际上， CPU在核心态下可以执行指令系统的全集。 形象地说， 特权指令是那些儿童不宜的东西,而非特权指令是老少皆宜的东西。

​	为了防止用户程序中使用特权指令， 用户态下只能使用非特权指令， 核心态下可以使用全部指令。 在用户态下使用特权指令时， 将产生中断以阻止用户使用特权指令。 所以把用户程序放在用户态下运行， 而操作系统中必须使用特权指令的那部分程序在核心态下运行， 保证了计算机系统的安全可靠。 从用户态转换为核心态的唯一途径是中断或异常

## 访管指令与访管中断

​	访管指令是一条可以在用户态下执行的指令。 在用户程序中， 因要求操作系统提供服务而有意识地使用访管指令， 从而产生一个中断事件（自愿中断） ， 将操作系统转换为核心态， 称为访管中断。 访管中断由访管指令产生， 程序员使用访管指令向操作系统请求服务。

​	为什么要在程序中引入访管指令呢？ 这是因为用户程序只能在用户态下运行。 若用户程序想要完成在用户态下无法完成的工作， 该怎么办？ 解决这个问题要靠访管指令。 访管指令本身不是特权指令， 其基本功能是让程序拥有“自愿进管” 的手段， 从而引起访管中断。处于用户态的用户程序使用访管指令时， 系统根据访管指令的操作数执行访管中断处理程序， 访管中断处理程序将按系统调用的操作数和参数转到相应的例行子程序。 完成服务功能后，退出中断， 返回到用户程序断点继续执行。

## 定义微内核结构OS的四个方面

1） 足够小的内核。

2） 基于客户/服务器模式。

3） 应用“机制与策略分离” 原理。 机制是指实现某一功能的具体执行机构。 策略则是在机制的基础上借助于某些参数和算法来实现该功能的优化， 或达到不同的功能目标。 在传统的OS中， 将机制放在OS内核的较低层中， 把策略放在内核的较高层中。 而在微内核OS中， 通常将机制放在OS的微内核中。 正因如此， 才可以将内核做得很小。

4） 采用面向对象技术。 基于面向对象技术中的"抽象” 和"隐蔽” 原则能控制系统的复杂性， 进一步利用"对象” “封装” 和"继承” 等概念还能确保操作系统的正确性、 可靠性、易扩展性等。 正因如此， 面向对象技术被广泛应用于现代操作系统的设计之中
